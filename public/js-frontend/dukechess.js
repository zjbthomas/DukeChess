var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var View=function(e){function t(e){var r=e.maxRow,n=e.maxCol;_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.createTable=function(){for(var e=[],t=a.props.maxRow-1;t>=0;t--){for(var r=[],n=0;n<a.props.maxCol;n++){var o=t*a.props.maxCol+n;r.push(React.createElement("td",{key:"td"+o},a.renderTile(o)))}e.push(React.createElement("tr",{key:"tr"+t},r))}return e},a.socket=io(),a.X=null,a.Y=null,a.socket.on("game",function(e){if(a.setState({connection:e.connection,msg:e.message}),"true"==e.connection)switch(e.type){case"chess":var t=Array(r*n).fill("url(image/BG.png)"),o=!0,i=!1,s=void 0;try{for(var l,c=Object.keys(e)[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){(_=l.value).indexOf("grid")>=0&&(id=parseInt(_.substring("grid_".length)),t[id]=e[_])}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}a.setState({chess:t});break;case"color":var u=Array(r*n).fill("grid"),h=!0,m=!1,p=void 0;try{for(var f,d=Object.keys(e)[Symbol.iterator]();!(h=(f=d.next()).done);h=!0){(_=f.value).indexOf("grid")>=0&&(id=parseInt(_.substring("grid_".length)),u[id]="grid "+e[_])}}catch(e){m=!0,p=e}finally{try{!h&&d.return&&d.return()}finally{if(m)throw p}}a.setState({color:u});break;case"menu":var g=[],y=!0,v=!1,b=void 0;try{for(var k,R=Object.keys(e.menus)[Symbol.iterator]();!(y=(k=R.next()).done);y=!0){var _=k.value;g.push(a.renderMenuButton(_,e.menus[_]))}}catch(e){v=!0,b=e}finally{try{!y&&R.return&&R.return()}finally{if(v)throw b}}0!=g.length&&a.setState({menu:g,showMenu:!0,X:a.X,Y:a.Y})}else a.reset(r,n)}),a.state={connection:!1,msg:"",chess:Array(r*n).fill("url(image/BG.png)"),color:Array(r*n).fill("grid"),hover:Array(r*n).fill(""),menu:null,showMenu:!1,X:null,Y:null,backImg:"url(image/BG.png)"},a}return _inherits(t,React.Component),_createClass(t,[{key:"reset",value:function(e,t){this.setState({chess:Array(e*t).fill("url(image/BG.png)"),color:Array(e*t).fill("grid"),hover:Array(e*t).fill(""),menu:null,showMenu:!1,X:null,Y:null,backImg:"url(image/BG.png)"})}},{key:"onGridClick",value:function(e,t){this.X=t.pageX-window.scrollX,this.Y=t.pageY-window.scrollY,this.socket.emit("game",{type:"grid_click",grid:"grid_"+e})}},{key:"onGridMouseEnter",value:function(e){var t=Array(this.props.maxRow*this.props.maxCol).fill("");if(t[e]="hovering",this.setState({hover:t}),"true"==this.state.connection){this.socket.emit("game",{type:"grid_hover",grid:"grid_"+e});var r=this.state.chess[e];r.indexOf("BG")<0&&(r=r.indexOf("f")>=0?r.replace("f","b"):r.replace("b","f"),this.setState({backImg:r}))}}},{key:"onGridMouseLeave",value:function(e){this.setState({hover:Array(this.props.maxRow*this.props.maxCol).fill("")}),this.socket.emit("game",{type:"hover_restore",grid:"grid_"+e}),this.setState({backImg:"url(image/BG.png)"})}},{key:"onMenuButtonClick",value:function(e){this.setState({showMenu:!1}),this.socket.emit("game",{type:"menu_click",value:e})}},{key:"renderMenuButton",value:function(e,t){var r=this;return React.createElement("div",{key:e},React.createElement("input",{className:"ibutton",type:"button",value:t,onClick:function(){return r.onMenuButtonClick(t)}}))}},{key:"renderTile",value:function(e){var t=this;return React.createElement(Tile,{id:e,chess:this.state.chess[e],color:this.state.color[e],hover:this.state.hover[e],onClick:function(r){return t.onGridClick(e,r)},onMouseEnter:function(){t.onGridMouseEnter(e)},onMouseLeave:function(){t.onGridMouseLeave(e)}})}},{key:"renderGame",value:function(){return React.createElement("table",{key:"game",id:"game"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"left",id:"board-container"},React.createElement("table",{id:"board"},React.createElement("tbody",null,this.createTable()))),React.createElement("td",{className:"right"},React.createElement("div",{className:"chess-info"},React.createElement("h4",null,"Back"),React.createElement(Back,{img:this.state.backImg}))))))}},{key:"render",value:function(){var e=[];return e.push(this.renderGame()),e.push(React.createElement(MessageBar,{key:"msgbar",msg:this.state.msg})),this.state.showMenu&&e.push(React.createElement(Menu,{key:"menu",menu:this.state.menu,pageX:this.state.X,pageY:this.state.Y})),e}}]),t}();function MessageBar(e){return React.createElement("div",{id:"msgbar"},e.msg)}function Menu(e){return React.createElement("div",{id:"menu",style:{left:e.pageX,top:e.pageY}},e.menu)}function Back(e){return React.createElement("div",{className:"chess-holder",style:{backgroundImage:e.img}})}var Tile=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this;return React.createElement("input",{type:"image",alt:"",id:"grid_"+this.props.id,className:this.props.color+" "+this.props.hover,style:{backgroundImage:this.props.chess},value:"",onClick:function(t){return e.props.onClick(t)},onMouseEnter:function(){return e.props.onMouseEnter()},onMouseLeave:function(){return e.props.onMouseLeave()}})}}]),t}();ReactDOM.render(React.createElement(View,{maxRow:6,maxCol:6}),document.getElementById("view"));